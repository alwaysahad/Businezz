import{s as r,T as n,i as f}from"./index-Y5CsEzuB.js";async function c(){if(!r)return null;const{data:{user:e}}=await r.auth.getUser();return(e==null?void 0:e.id)||null}const m={async getAll(){if(!r)return[];const{data:e,error:t}=await r.from(n.INVOICES).select("*").order("created_at",{ascending:!1});if(t)throw t;return(e||[]).map(i)},async getById(e){if(!r)return null;const{data:t,error:s}=await r.from(n.INVOICES).select("*").eq("id",e).single();if(s&&s.code!=="PGRST116")throw s;return t?i(t):null},async save(e){if(!r)throw new Error("Database not configured");const t=await c();if(!t)throw new Error("User not authenticated");const s={...S(e),user_id:t},{data:a,error:o}=await r.from(n.INVOICES).upsert(s,{onConflict:"id"}).select().single();if(o)throw o;return i(a)},async delete(e){if(!r)throw new Error("Database not configured");const{error:t}=await r.from(n.INVOICES).delete().eq("id",e);if(t)throw t}},l={async getAll(){if(!r)return[];const{data:e,error:t}=await r.from(n.CUSTOMERS).select("*").order("name");if(t)throw t;return e||[]},async save(e){if(!r)throw new Error("Database not configured");const t=await c();if(!t)throw new Error("User not authenticated");const s={...e,user_id:t},{data:a,error:o}=await r.from(n.CUSTOMERS).upsert(s,{onConflict:"id"}).select().single();if(o)throw o;return a},async delete(e){if(!r)throw new Error("Database not configured");const{error:t}=await r.from(n.CUSTOMERS).delete().eq("id",e);if(t)throw t}},w={async getAll(){if(!r)return[];const{data:e,error:t}=await r.from(n.PRODUCTS).select("*").order("name");if(t)throw t;return e||[]},async save(e){if(!r)throw new Error("Database not configured");const t=await c();if(!t)throw new Error("User not authenticated");const s={...e,user_id:t},{data:a,error:o}=await r.from(n.PRODUCTS).upsert(s,{onConflict:"id"}).select().single();if(o)throw o;return a},async delete(e){if(!r)throw new Error("Database not configured");const{error:t}=await r.from(n.PRODUCTS).delete().eq("id",e);if(t)throw t}},h={async get(){if(!r)return null;const{data:e,error:t}=await r.from(n.BUSINESS).select("*").single();if(t&&t.code!=="PGRST116")throw t;return e?u(e):null},async save(e){if(!r)throw new Error("Database not configured");const t=await c();if(!t)throw new Error("User not authenticated");const s={..._(e),user_id:t},{data:a,error:o}=await r.from(n.BUSINESS).upsert(s,{onConflict:"user_id"}).select().single();if(o)throw o;return u(a)}},g={async get(){if(!r)return null;const{data:e,error:t}=await r.from(n.SETTINGS).select("*").single();if(t&&t.code!=="PGRST116")throw t;return e?d(e):null},async save(e){if(!r)throw new Error("Database not configured");const t=await c();if(!t)throw new Error("User not authenticated");const s={...p(e),user_id:t},{data:a,error:o}=await r.from(n.SETTINGS).upsert(s,{onConflict:"user_id"}).select().single();if(o)throw o;return d(a)}};async function I(e){if(!f||!r)return{success:!1,message:"Supabase not configured"};try{for(const t of e.invoices)await m.save(t);for(const t of e.customers)await l.save(t);for(const t of e.products)await w.save(t);return e.business.name&&await h.save(e.business),await g.save(e.settings),{success:!0,message:"All data synced to cloud successfully!"}}catch(t){return console.error("Sync to cloud failed:",t),{success:!1,message:`Sync failed: ${t.message}`}}}function i(e){return{id:e.id,invoiceNumber:e.invoice_number,date:e.date,customerName:e.customer_name,customerEmail:e.customer_email,customerPhone:e.customer_phone,customerAddress:e.customer_address,items:e.items||[],taxRate:e.tax_rate,discount:e.discount,notes:e.notes,status:e.status,createdAt:e.created_at,updatedAt:e.updated_at}}function S(e){return{id:e.id,invoice_number:e.invoiceNumber,date:e.date,customer_name:e.customerName,customer_email:e.customerEmail,customer_phone:e.customerPhone,customer_address:e.customerAddress,items:e.items,tax_rate:e.taxRate,discount:e.discount,notes:e.notes,status:e.status,created_at:e.createdAt||new Date().toISOString(),updated_at:new Date().toISOString()}}function u(e){return{id:e.id,name:e.name,address:e.address,city:e.city,state:e.state,pincode:e.pincode,phone:e.phone,email:e.email,taxId:e.tax_id,logo:e.logo,currency:e.currency,taxRate:e.tax_rate}}function _(e){return{id:e.id,name:e.name,address:e.address,city:e.city,state:e.state,pincode:e.pincode,phone:e.phone,email:e.email,tax_id:e.taxId,logo:e.logo,currency:e.currency,tax_rate:e.taxRate,updated_at:new Date().toISOString()}}function d(e){return{id:e.id,currency:e.currency,taxRate:e.tax_rate,invoicePrefix:e.invoice_prefix,defaultPaymentTerms:e.default_payment_terms,showLogo:e.show_logo,taxLabel:e.tax_label}}function p(e){return{id:e.id,currency:e.currency,tax_rate:e.taxRate,invoice_prefix:e.invoicePrefix,default_payment_terms:e.defaultPaymentTerms,show_logo:e.showLogo,tax_label:e.taxLabel,updated_at:new Date().toISOString()}}export{I as a,h as b,l as c,m as i,w as p,g as s};
