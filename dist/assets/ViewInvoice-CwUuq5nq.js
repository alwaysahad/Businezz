import{j as e}from"./react-query-0I5YXCIV.js";import{b as A,f as E,r as c,L as j}from"./react-vendor-GSsPULXx.js";import{c as T,g as B,a as R,d as q,f as r,n as M}from"./helpers-CsfFra1r.js";import{d as x,o as O,g as z}from"./pdfGenerator-BkENJqov.js";import{c as U,u as W,b as Q}from"./useData-IJAFWeEu.js";import{f as g,q as N,o as y,h as V,C as Y,A as G,s as H,D as J,t as K,u as X}from"./ui-libs-B_77BvNz.js";import"./database-zdMLZIvB.js";import"./index-Y5CsEzuB.js";import"./supabase-DfwcnzK-.js";function ie(){const b=A(),{id:v}=E(),{invoice:s,loading:w,saveInvoice:I}=U(v),{business:t,loading:S}=W(),{settings:l,loading:P}=Q(),k=c.useRef(null),[m,o]=c.useState(!1),[d,h]=c.useState(!1),[u,p]=c.useState(!1),f=w||S||P;if(f&&!s)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(g,{className:"animate-spin w-8 h-8 text-teal-400"}),e.jsx("p",{className:"text-midnight-400",children:"Loading invoice..."})]})});if(!s)return f?null:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"Invoice Not Found"}),e.jsxs(j,{to:"/invoices",className:"btn-primary inline-flex items-center gap-2",children:[e.jsx(N,{className:"w-5 h-5"}),"Back to Invoices"]})]});const i=T(s.items,s.taxRate,s.discount),C=()=>{x(s,t,l)},D=()=>{O(s,t,l)},F=async a=>{p(!0);try{const n={...s,status:a};await I(n),o(!1)}catch(n){console.error("Failed to update status",n)}finally{p(!1)}},L=async()=>{h(!0);try{const a=z(s,t,l),n=new File([a],`${s.invoiceNumber}.pdf`,{type:"application/pdf"});navigator.share&&navigator.canShare({files:[n]})?await navigator.share({title:`Invoice ${s.invoiceNumber}`,text:`Invoice for ${s.customerName} - ${r(i.total,t.currency)}`,files:[n]}):x(s,t,l)}catch(a){a.name!=="AbortError"&&(console.error("Error sharing:",a),x(s,t,l))}h(!1)},$=[{value:"draft",label:"Draft",icon:y,color:"text-midnight-400"},{value:"pending",label:"Pending",icon:V,color:"text-gold-400"},{value:"paid",label:"Paid",icon:Y,color:"text-teal-400"},{value:"overdue",label:"Overdue",icon:G,color:"text-coral-400"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>b("/invoices"),className:"p-2 rounded-lg hover:bg-midnight-700 transition-colors",children:e.jsx(N,{className:"w-5 h-5 text-midnight-300"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-2xl font-display font-bold text-white",children:s.invoiceNumber}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>o(!m),className:`px-3 py-1 rounded-full text-sm font-medium ${R(s.status)} hover:opacity-80 transition-opacity flex items-center gap-2`,disabled:u,children:u?e.jsx(g,{className:"w-3 h-3 animate-spin"}):B(s.status)}),m&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>o(!1)}),e.jsx("div",{className:"absolute left-0 top-full mt-2 w-40 bg-midnight-800 border border-midnight-600 rounded-xl shadow-lg overflow-hidden z-20",children:$.map(a=>{const n=a.icon;return e.jsxs("button",{onClick:()=>F(a.value),className:`flex items-center gap-3 px-4 py-3 w-full hover:bg-midnight-700 transition-colors ${s.status===a.value?"bg-midnight-700":""}`,children:[e.jsx(n,{className:`w-4 h-4 ${a.color}`}),e.jsx("span",{className:"text-white",children:a.label}),s.status===a.value&&e.jsx(H,{className:"w-4 h-4 text-teal-400 ml-auto"})]},a.value)})})]})]})]}),e.jsx("p",{className:"text-midnight-400",children:s.customerName})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 w-full sm:w-auto",children:[e.jsxs(j,{to:`/invoices/edit/${s.id}`,className:"btn-secondary flex items-center justify-center gap-2 flex-1 sm:flex-none",children:[e.jsx(y,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden xs:inline",children:"Edit"})]}),e.jsxs("button",{onClick:C,className:"btn-secondary flex items-center justify-center gap-2 flex-1 sm:flex-none",children:[e.jsx(J,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden xs:inline",children:"Download"})]}),e.jsxs("button",{onClick:D,className:"btn-secondary flex items-center justify-center gap-2 flex-1 sm:flex-none",children:[e.jsx(K,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden xs:inline",children:"Print"})]}),e.jsxs("button",{onClick:L,disabled:d,className:"btn-primary flex items-center justify-center gap-2 flex-1 sm:flex-none disabled:opacity-50",children:[e.jsx(X,{className:`w-4 h-4 ${d?"animate-pulse":""}`}),d?"Sharing...":"Share PDF"]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft overflow-hidden",ref:k,children:[e.jsx("div",{className:"bg-gradient-to-r from-teal-600 to-teal-700 px-8 py-6 text-white",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-display font-bold",children:t.name||"Your Business Name"}),t.address&&e.jsx("p",{className:"text-teal-100 mt-1 text-sm",children:t.address}),t.city&&e.jsxs("p",{className:"text-teal-100 text-sm",children:[t.city,t.state&&`, ${t.state}`,t.pincode&&` - ${t.pincode}`]}),t.phone&&e.jsxs("p",{className:"text-teal-100 text-sm",children:["Phone: ",t.phone]}),t.email&&e.jsxs("p",{className:"text-teal-100 text-sm",children:["Email: ",t.email]}),t.taxId&&e.jsxs("p",{className:"text-teal-100 text-sm font-mono",children:[l.taxLabel||"Tax"," ID: ",t.taxId]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-teal-200 text-sm uppercase tracking-wide",children:"Invoice"}),e.jsx("p",{className:"text-xl font-mono font-bold mt-1",children:s.invoiceNumber}),e.jsxs("p",{className:"text-teal-100 text-sm mt-2",children:["Date: ",q(s.date)]})]})]})}),e.jsxs("div",{className:"px-8 py-6 border-b border-gray-100",children:[e.jsx("p",{className:"text-gray-400 text-xs uppercase tracking-wide mb-2",children:"Bill To"}),e.jsx("p",{className:"text-gray-900 font-semibold text-lg",children:s.customerName}),s.customerAddress&&e.jsx("p",{className:"text-gray-600 text-sm",children:s.customerAddress}),s.customerPhone&&e.jsxs("p",{className:"text-gray-600 text-sm",children:["Phone: ",s.customerPhone]}),s.customerEmail&&e.jsxs("p",{className:"text-gray-600 text-sm",children:["Email: ",s.customerEmail]})]}),e.jsx("div",{className:"px-8 py-6",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2 border-gray-200",children:[e.jsx("th",{className:"text-left py-3 text-gray-500 font-medium text-xs w-12",children:"#"}),e.jsx("th",{className:"text-left py-3 text-gray-500 font-medium text-xs",children:"Item"}),e.jsx("th",{className:"text-center py-3 text-gray-500 font-medium text-xs w-20",children:"Qty"}),e.jsx("th",{className:"text-right py-3 text-gray-500 font-medium text-xs w-28",children:"Price"}),e.jsx("th",{className:"text-right py-3 text-gray-500 font-medium text-xs w-28",children:"Amount"})]})}),e.jsx("tbody",{children:s.items.map((a,n)=>e.jsxs("tr",{className:"border-b border-gray-100",children:[e.jsx("td",{className:"py-4 text-gray-400 text-sm",children:n+1}),e.jsx("td",{className:"py-4 text-gray-900 font-medium",children:a.name}),e.jsx("td",{className:"py-4 text-gray-600 text-center",children:a.quantity}),e.jsx("td",{className:"py-4 text-gray-600 text-right font-mono text-sm",children:r(a.price,t.currency)}),e.jsx("td",{className:"py-4 text-gray-900 text-right font-mono font-medium",children:r(a.quantity*a.price,t.currency)})]},a.id))})]})}),e.jsxs("div",{className:"px-8 py-6 bg-gray-50",children:[e.jsx("div",{className:"flex justify-end",children:e.jsxs("div",{className:"w-full sm:w-64 space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsx("span",{children:"Subtotal"}),e.jsx("span",{className:"font-mono",children:r(i.subtotal,t.currency)})]}),s.discount>0&&e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsxs("span",{children:["Discount (",s.discount,"%)"]}),e.jsxs("span",{className:"font-mono text-red-500",children:["-",r(i.discountAmount,t.currency)]})]}),s.taxRate>0&&e.jsxs("div",{className:"flex justify-between text-gray-600",children:[e.jsxs("span",{children:[l.taxLabel||"Tax"," (",s.taxRate,"%)"]}),e.jsx("span",{className:"font-mono",children:r(i.taxAmount,t.currency)})]}),e.jsxs("div",{className:"flex justify-between text-xl font-bold pt-3 border-t-2 border-gray-200",children:[e.jsx("span",{className:"text-gray-900",children:"Total"}),e.jsx("span",{className:"font-mono text-teal-600",children:r(i.total,t.currency)})]})]})}),e.jsxs("div",{className:"mt-6 pt-4 border-t border-gray-200",children:[e.jsx("p",{className:"text-gray-400 text-xs uppercase tracking-wide",children:"Amount in Words"}),e.jsxs("p",{className:"text-gray-700 font-medium",children:[M(Math.floor(i.total))," Only"]})]})]}),s.notes&&e.jsxs("div",{className:"px-8 py-6 border-t border-gray-100",children:[e.jsx("p",{className:"text-gray-400 text-xs uppercase tracking-wide mb-2",children:"Notes"}),e.jsx("p",{className:"text-gray-600 whitespace-pre-line",children:s.notes})]}),e.jsx("div",{className:"px-8 py-6 bg-gray-50 text-center border-t border-gray-100",children:e.jsx("p",{className:"text-gray-400 text-sm",children:"Thank you for your business!"})})]})]})}export{ie as default};
