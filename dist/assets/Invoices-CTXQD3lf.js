import{j as e}from"./react-query-0I5YXCIV.js";import{r as o,L as p}from"./react-vendor-GSsPULXx.js";import{c as v,g as Q,a as H,d as U,f as G}from"./helpers-C0Vzrg-0.js";import{d as J}from"./pdfGenerator-BDzhLCw7.js";import{a as K,u as X,b as Y}from"./useData-RV3j1BkV.js";import{f as Z,P as S,j as _,k as ee,l as L,m as I,F as se,n as te,E as ae,o as le,D as ne,p as ie}from"./ui-libs-B_77BvNz.js";import"./database-B9qL7xqw.js";import"./index-zt1W6VbK.js";import"./supabase-DfwcnzK-.js";function fe(){const{invoices:a,loading:A,deleteInvoice:F}=K(),{business:b,loading:P}=X(),{settings:$,loading:M}=Y(),T=A||P||M,[d,B]=o.useState(""),[m,E]=o.useState("all"),[n,z]=o.useState("date"),[x,y]=o.useState("desc"),[f,c]=o.useState(null),[C,j]=o.useState(null),[N,k]=o.useState(null),w=o.useMemo(()=>{let s=[...a];if(d){const t=d.toLowerCase();s=s.filter(l=>{var i,r,u,g;return((i=l.customerName)==null?void 0:i.toLowerCase().includes(t))||((r=l.invoiceNumber)==null?void 0:r.toLowerCase().includes(t))||((u=l.customerEmail)==null?void 0:u.toLowerCase().includes(t))||((g=l.customerPhone)==null?void 0:g.includes(t))})}return m!=="all"&&(s=s.filter(t=>t.status===m)),s.sort((t,l)=>{var u,g;let i,r;if(n==="date")i=new Date(t.createdAt||t.date).getTime(),r=new Date(l.createdAt||l.date).getTime();else if(n==="amount"){const W=v(t.items,t.taxRate,t.discount),q=v(l.items,l.taxRate,l.discount);i=W.total,r=q.total}else n==="customer"?(i=((u=t.customerName)==null?void 0:u.toLowerCase())||"",r=((g=l.customerName)==null?void 0:g.toLowerCase())||""):(i=t.invoiceNumber,r=l.invoiceNumber);return x==="asc"?i>r?1:-1:i<r?1:-1}),s},[a,d,m,n,x]),h=o.useMemo(()=>({total:a.length,draft:a.filter(s=>s.status==="draft").length,pending:a.filter(s=>s.status==="pending").length,paid:a.filter(s=>s.status==="paid").length,overdue:a.filter(s=>s.status==="overdue").length}),[a]),R=async s=>{k(s);try{await F(s)}catch(t){console.error("Failed to delete invoice:",t)}finally{k(null),j(null),c(null)}},O=s=>{J(s,b,$),c(null)},D=s=>{n===s?y(x==="asc"?"desc":"asc"):(z(s),y("desc"))},V=s=>{B(s.target.value)};return T&&a.length===0?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Z,{className:"w-8 h-8 text-teal-400 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-midnight-400",children:"Loading invoices..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-display font-bold text-white",children:"Invoices"}),e.jsxs("p",{className:"text-midnight-400",children:[w.length," of ",a.length," invoices"]})]}),e.jsxs(p,{to:"/invoices/new",className:"btn-primary flex items-center gap-2 self-start",children:[e.jsx(S,{className:"w-5 h-5"}),e.jsx("span",{children:"New Invoice"})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[{key:"all",label:"All",count:h.total},{key:"draft",label:"Draft",count:h.draft},{key:"pending",label:"Pending",count:h.pending},{key:"paid",label:"Paid",count:h.paid},{key:"overdue",label:"Overdue",count:h.overdue}].map(s=>e.jsxs("button",{onClick:()=>E(s.key),className:`px-4 py-2 rounded-xl text-sm font-medium transition-colors ${m===s.key?"bg-teal-500/20 text-teal-400":"bg-midnight-700/50 text-midnight-300 hover:bg-midnight-700"}`,children:[s.label,e.jsx("span",{className:"ml-2 px-2 py-0.5 rounded-full text-xs bg-midnight-800",children:s.count})]},s.key))}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(_,{className:"absolute left-3.5 top-1/2 -translate-y-1/2 w-5 h-5 text-midnight-400 pointer-events-none"}),e.jsx("input",{type:"text",placeholder:"Search invoices...",value:d,onChange:V,className:"input-field pl-11"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>D("date"),className:`btn-secondary flex items-center gap-2 ${n==="date"?"border-teal-500":""}`,children:[e.jsx(ee,{className:"w-4 h-4"}),"Date",n==="date"&&(x==="asc"?e.jsx(L,{className:"w-4 h-4"}):e.jsx(I,{className:"w-4 h-4"}))]}),e.jsxs("button",{onClick:()=>D("amount"),className:`btn-secondary flex items-center gap-2 ${n==="amount"?"border-teal-500":""}`,children:[e.jsx(re,{className:"w-4 h-4"}),"Amount",n==="amount"&&(x==="asc"?e.jsx(L,{className:"w-4 h-4"}):e.jsx(I,{className:"w-4 h-4"}))]})]})]}),w.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(se,{className:"w-16 h-16 text-midnight-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"No invoices found"}),e.jsx("p",{className:"text-midnight-400 mb-6",children:d||m!=="all"?"Try adjusting your search or filters":"Create your first invoice to get started"}),!d&&m==="all"&&e.jsxs(p,{to:"/invoices/new",className:"btn-primary inline-flex items-center gap-2",children:[e.jsx(S,{className:"w-5 h-5"}),"Create Invoice"]})]}):e.jsx("div",{className:"space-y-3",children:w.map(s=>{const t=v(s.items,s.taxRate,s.discount);return e.jsx("div",{className:`glass rounded-xl p-4 sm:p-6 card-hover animate-fade-in ${f===s.id?"relative z-30":""}`,children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(p,{to:`/invoices/view/${s.id}`,className:"text-lg font-semibold text-white hover:text-teal-400 transition-colors truncate",children:s.customerName}),e.jsx("span",{className:`px-2.5 py-1 rounded-full text-xs font-medium ${H(s.status)}`,children:Q(s.status)})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-1 text-sm text-midnight-400",children:[e.jsx("span",{className:"font-mono",children:s.invoiceNumber}),e.jsx("span",{children:"•"}),e.jsx("span",{children:U(s.date)}),s.items.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs("span",{children:[s.items.length," item",s.items.length>1?"s":""]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"text-2xl font-mono font-bold text-white",children:G(t.total,b.currency)})}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>c(f===s.id?null:s.id),className:"p-2 rounded-lg hover:bg-midnight-700 transition-colors",children:e.jsx(te,{className:"w-5 h-5 text-midnight-400"})}),f===s.id&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>c(null)}),e.jsxs("div",{className:"absolute right-0 top-full mt-2 w-48 bg-midnight-800 border border-midnight-600 rounded-xl shadow-lg overflow-hidden z-50",children:[e.jsxs(p,{to:`/invoices/view/${s.id}`,className:"flex items-center gap-3 px-4 py-3 text-white hover:bg-midnight-700 transition-colors",onClick:()=>c(null),children:[e.jsx(ae,{className:"w-4 h-4 text-midnight-400"}),"View Invoice"]}),e.jsxs(p,{to:`/invoices/edit/${s.id}`,className:"flex items-center gap-3 px-4 py-3 text-white hover:bg-midnight-700 transition-colors",onClick:()=>c(null),children:[e.jsx(le,{className:"w-4 h-4 text-midnight-400"}),"Edit Invoice"]}),e.jsxs("button",{onClick:()=>O(s),className:"flex items-center gap-3 px-4 py-3 text-white hover:bg-midnight-700 transition-colors w-full",children:[e.jsx(ne,{className:"w-4 h-4 text-midnight-400"}),"Download PDF"]}),e.jsxs("button",{onClick:()=>{j(s.id),c(null)},className:"flex items-center gap-3 px-4 py-3 text-coral-400 hover:bg-coral-500/10 transition-colors w-full",children:[e.jsx(ie,{className:"w-4 h-4"}),"Delete"]})]})]})]})]})]})},s.id)})}),C&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70",children:e.jsxs("div",{className:"glass rounded-2xl p-6 max-w-md w-full animate-scale-in",children:[e.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"Delete Invoice?"}),e.jsx("p",{className:"text-midnight-400 mb-6",children:"This action cannot be undone."}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:()=>j(null),className:"btn-secondary",disabled:N!==null,children:"Cancel"}),e.jsx("button",{onClick:()=>R(C),className:"btn-danger",disabled:N!==null,children:N?"Deleting...":"Delete"})]})]})})]})}function re(a){return e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8"}),e.jsx("path",{d:"M12 18V6"})]})}export{fe as default};
