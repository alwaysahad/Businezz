import{j as e}from"./react-query-BSlkKaxv.js";import{r as i,L as h}from"./react-vendor-DCAT8MD5.js";import{a as V,u as W,b as Q}from"./useData-CpxXeTce.js";import{u as G}from"./usePDFGenerator-D8Z-rg1M.js";import{c as u,g as H,a as U,d as J,f as K}from"./helpers-nstW7FaL.js";import{h as X,P as D,o as Y,p as Z,q as S,r as I,F as _,s as ee,E as se,t as te,D as ae,u as le}from"./ui-libs-x-WnpP75.js";import"./database-DIn5S9pN.js";import"./index-DGIWkH9N.js";import"./supabase-DfwcnzK-.js";function ge(){const{invoices:a,loading:L,deleteInvoice:F}=V(),{business:b,loading:P}=W(),{settings:$,loading:T}=Q(),{downloadPDF:M}=G(),A=L||P||T,[r,E]=i.useState(""),[d,R]=i.useState("all"),[o,z]=i.useState("date"),[m,v]=i.useState("desc"),[f,c]=i.useState(null),[y,j]=i.useState(null),[N,k]=i.useState(null),w=i.useMemo(()=>{let s=[...a];if(r){const t=r.toLowerCase();s=s.filter(l=>{var n,g,p;return((n=l.customerName)==null?void 0:n.toLowerCase().includes(t))||((g=l.invoiceNumber)==null?void 0:g.toLowerCase().includes(t))||((p=l.customerEmail)==null?void 0:p.toLowerCase().includes(t))})}return d!=="all"&&(s=s.filter(t=>t.status===d)),s.sort((t,l)=>{let n=0;switch(o){case"date":n=new Date(t.date).getTime()-new Date(l.date).getTime();break;case"amount":{const g=u(t.items,t.taxRate,t.discount).total,p=u(l.items,l.taxRate,l.discount).total;n=g-p;break}case"customer":n=(t.customerName||"").localeCompare(l.customerName||"");break;case"number":n=(t.invoiceNumber||"").localeCompare(l.invoiceNumber||"");break}return m==="asc"?n:-n}),s},[a,r,d,o,m]),x=i.useMemo(()=>({total:a.reduce((s,t)=>s+u(t.items,t.taxRate,t.discount).total,0),draft:a.filter(s=>s.status==="draft").length,pending:a.reduce((s,t)=>t.status==="pending"?s+u(t.items,t.taxRate,t.discount).total:s,0),paid:a.filter(s=>s.status==="paid").length,overdue:a.filter(s=>s.status==="overdue").length}),[a]),B=async s=>{k(s);try{await F(s)}catch(t){console.error("Failed to delete invoice:",t)}finally{k(null),j(null),c(null)}},q=async s=>{try{await M(s,b,$,`${s.invoiceNumber}.pdf`),c(null)}catch(t){console.error("Failed to download PDF:",t)}},C=s=>{o===s?v(m==="asc"?"desc":"asc"):(z(s),v("desc"))},O=s=>{E(s.target.value)};return A&&a.length===0?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(X,{className:"w-8 h-8 text-teal-400 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-midnight-400",children:"Loading invoices..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-display font-bold text-white",children:"Invoices"}),e.jsxs("p",{className:"text-midnight-400",children:[w.length," of ",a.length," invoices"]})]}),e.jsxs(h,{to:"/invoices/new",className:"btn-primary flex items-center gap-2 self-start",children:[e.jsx(D,{className:"w-5 h-5"}),e.jsx("span",{children:"New Invoice"})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:[{key:"all",label:"All",count:x.total},{key:"draft",label:"Draft",count:x.draft},{key:"pending",label:"Pending",count:x.pending},{key:"paid",label:"Paid",count:x.paid},{key:"overdue",label:"Overdue",count:x.overdue}].map(s=>e.jsxs("button",{onClick:()=>R(s.key),className:`px-4 py-2 rounded-xl text-sm font-medium transition-colors ${d===s.key?"bg-teal-500/20 text-teal-400":"bg-midnight-700/50 text-midnight-300 hover:bg-midnight-700"}`,children:[s.label,e.jsx("span",{className:"ml-2 px-2 py-0.5 rounded-full text-xs bg-midnight-800",children:s.count})]},s.key))}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Y,{className:`absolute left-3.5 top-1/2 -translate-y-1/2 w-5 h-5 text-midnight-400 pointer-events-none transition-opacity duration-200 ${r?"opacity-0":"opacity-100"}`}),e.jsx("input",{type:"text",value:r,onChange:O,className:"input-field pl-11"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:()=>C("date"),className:`btn-secondary flex items-center gap-2 ${o==="date"?"border-teal-500":""}`,children:[e.jsx(Z,{className:"w-4 h-4"}),"Date",o==="date"&&(m==="asc"?e.jsx(S,{className:"w-4 h-4"}):e.jsx(I,{className:"w-4 h-4"}))]}),e.jsxs("button",{onClick:()=>C("amount"),className:`btn-secondary flex items-center gap-2 ${o==="amount"?"border-teal-500":""}`,children:[e.jsx(ne,{className:"w-4 h-4"}),"Amount",o==="amount"&&(m==="asc"?e.jsx(S,{className:"w-4 h-4"}):e.jsx(I,{className:"w-4 h-4"}))]})]})]}),w.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(_,{className:"w-16 h-16 text-midnight-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"No invoices found"}),e.jsx("p",{className:"text-midnight-400 mb-6",children:r||d!=="all"?"Try adjusting your search or filters":"Create your first invoice to get started"}),!r&&d==="all"&&e.jsxs(h,{to:"/invoices/new",className:"btn-primary inline-flex items-center gap-2",children:[e.jsx(D,{className:"w-5 h-5"}),"Create Invoice"]})]}):e.jsx("div",{className:"space-y-3",children:w.map(s=>{const t=u(s.items,s.taxRate,s.discount);return e.jsx("div",{className:`glass rounded-xl p-4 sm:p-6 card-hover animate-fade-in ${f===s.id?"relative z-30":""}`,children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(h,{to:`/invoices/view/${s.id}`,className:"text-lg font-semibold text-white hover:text-teal-400 transition-colors truncate",children:s.customerName}),e.jsx("span",{className:`px-2.5 py-1 rounded-full text-xs font-medium ${U(s.status)}`,children:H(s.status)})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-x-4 gap-y-1 text-sm text-midnight-400",children:[e.jsx("span",{className:"font-mono",children:s.invoiceNumber}),e.jsx("span",{children:"•"}),e.jsx("span",{children:J(s.date)}),s.items.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("span",{children:"•"}),e.jsxs("span",{children:[s.items.length," item",s.items.length>1?"s":""]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"text-2xl font-mono font-bold text-white",children:K(t.total,b.currency)})}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>c(f===s.id?null:s.id),className:"p-2 rounded-lg hover:bg-midnight-700 transition-colors",children:e.jsx(ee,{className:"w-5 h-5 text-midnight-400"})}),f===s.id&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>c(null)}),e.jsxs("div",{className:"absolute right-0 top-full mt-2 w-48 bg-midnight-800 border border-midnight-600 rounded-xl shadow-lg overflow-hidden z-50",children:[e.jsxs(h,{to:`/invoices/view/${s.id}`,className:"flex items-center gap-3 px-4 py-3 text-white hover:bg-midnight-700 transition-colors",onClick:()=>c(null),children:[e.jsx(se,{className:"w-4 h-4 text-midnight-400"}),"View Invoice"]}),e.jsxs(h,{to:`/invoices/edit/${s.id}`,className:"flex items-center gap-3 px-4 py-3 text-white hover:bg-midnight-700 transition-colors",onClick:()=>c(null),children:[e.jsx(te,{className:"w-4 h-4 text-midnight-400"}),"Edit Invoice"]}),e.jsxs("button",{onClick:()=>q(s),className:"flex items-center gap-3 px-4 py-3 text-white hover:bg-midnight-700 transition-colors w-full",children:[e.jsx(ae,{className:"w-4 h-4 text-midnight-400"}),"Download PDF"]}),e.jsxs("button",{onClick:()=>{j(s.id),c(null)},className:"flex items-center gap-3 px-4 py-3 text-coral-400 hover:bg-coral-500/10 transition-colors w-full",children:[e.jsx(le,{className:"w-4 h-4"}),"Delete"]})]})]})]})]})]})},s.id)})}),y&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70",children:e.jsxs("div",{className:"glass rounded-2xl p-6 max-w-md w-full animate-scale-in",children:[e.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"Delete Invoice?"}),e.jsx("p",{className:"text-midnight-400 mb-6",children:"This action cannot be undone."}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:()=>j(null),className:"btn-secondary",disabled:N!==null,children:"Cancel"}),e.jsx("button",{onClick:()=>B(y),className:"btn-danger",disabled:N!==null,children:N?"Deleting...":"Delete"})]})]})})]})}function ne(a){return e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...a,children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8"}),e.jsx("path",{d:"M12 18V6"})]})}export{ge as default};
