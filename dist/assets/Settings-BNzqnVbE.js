import{j as e}from"./react-query-0I5YXCIV.js";import{r as m}from"./react-vendor-GSsPULXx.js";import{u as U,b as E}from"./useData-BNLmJ_s2.js";import{f as y,s as G,r as $,B as M,F as O,p as w,z as S}from"./ui-libs-B_77BvNz.js";import"./database-Dl3kmWnY.js";import"./index-CHnLeUAe.js";import"./supabase-DfwcnzK-.js";const V=[{id:"business",label:"Business Profile",icon:M},{id:"invoice",label:"Invoice Settings",icon:O}];function W(){const{business:p,loading:C,saveBusiness:h}=U(),{settings:u,loading:B,saveSettings:L}=E(),[s,l]=m.useState({}),[i,j]=m.useState({});m.useEffect(()=>{p&&Object.keys(p).length>0&&l(p)},[p]),m.useEffect(()=>{u&&Object.keys(u).length>0&&j({...u,showLogo:u.showLogo??!0})},[u]);const[N,r]=m.useState(!1),[v,x]=m.useState(!1),[b,P]=m.useState("business"),d=a=>{const{name:t,value:o}=a.target;l(n=>({...n,[t]:o}))},f=a=>{const{name:t,value:o,type:n}=a.target;j(c=>({...c,[t]:n==="number"?parseFloat(o)||0:o}))},T=async()=>{x(!0);try{await Promise.all([h(s),L(i)]),r(!0),setTimeout(()=>r(!1),2e3)}catch(a){console.error("Failed to save settings:",a)}finally{x(!1)}},F=a=>{var o;const t=(o=a.target.files)==null?void 0:o[0];if(t){const n=new FileReader;n.onloadend=async()=>{const c={...s,logo:n.result};if(l(c),!s.name||!s.email){alert("Please fill in your business name and email before uploading a logo."),l(s);return}x(!0);try{await h(c),r(!0),setTimeout(()=>r(!1),2e3)}catch(g){console.error("Failed to save logo:",g),alert("Failed to save logo. Please try again."),l(s)}finally{x(!1)}},n.readAsDataURL(t)}},I=async()=>{const a={...s,logo:null};l(a);try{await h(a),r(!0),setTimeout(()=>r(!1),2e3)}catch(t){console.error("Failed to remove logo:",t),l(s)}},k=a=>{var o;const t=(o=a.target.files)==null?void 0:o[0];if(t){const n=new FileReader;n.onloadend=async()=>{const c={...s,signature:n.result};if(l(c),!s.name||!s.email){alert("Please fill in your business name and email before uploading a signature."),l(s);return}x(!0);try{console.log("Attempting to save signature. Business data:",{hasName:!!s.name,hasEmail:!!s.email,hasSignature:!!c.signature,businessKeys:Object.keys(c)}),await h(c),r(!0),setTimeout(()=>r(!1),2e3)}catch(g){console.error("Failed to save signature. Full error:",g);const D=g instanceof Error?g.message:"Unknown error";alert(`Failed to save signature: ${D}

Please check the browser console for details.`),l(s)}finally{x(!1)}},n.readAsDataURL(t)}},R=async()=>{const a={...s,signature:null};l(a);try{await h(a),r(!0),setTimeout(()=>r(!1),2e3)}catch(t){console.error("Failed to remove signature:",t),l(s)}},A=()=>{j(a=>({...a,showLogo:!a.showLogo}))};return C||B?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(y,{className:"w-8 h-8 text-teal-400 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-midnight-400",children:"Loading settings..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-display font-bold text-white",children:"Settings"}),e.jsx("p",{className:"text-midnight-400",children:"Manage your business profile and settings"})]}),e.jsx("button",{onClick:T,disabled:v,className:`btn-primary flex items-center gap-2 self-start transition-all ${N?"bg-teal-600":""}`,children:v?e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"w-5 h-5 animate-spin"}),"Saving..."]}):N?e.jsxs(e.Fragment,{children:[e.jsx(G,{className:"w-5 h-5"}),"Saved!"]}):e.jsxs(e.Fragment,{children:[e.jsx($,{className:"w-5 h-5"}),"Save Changes"]})})]}),e.jsx("div",{className:"flex flex-wrap gap-2 border-b border-midnight-700 pb-4",children:V.map(a=>{const t=a.icon;return e.jsxs("button",{onClick:()=>P(a.id),className:`flex items-center gap-2 px-4 py-2 rounded-xl transition-colors ${b===a.id?"bg-teal-500/20 text-teal-400":"text-midnight-400 hover:text-white hover:bg-midnight-700"}`,children:[e.jsx(t,{className:"w-5 h-5"}),a.label]},a.id)})}),b==="business"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-6",children:e.jsxs("div",{className:"glass rounded-2xl p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Business Information"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Business Name"}),e.jsx("input",{type:"text",name:"name",value:s.name||"",onChange:d,className:"input-field",placeholder:"Your business name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Address"}),e.jsx("textarea",{name:"address",value:s.address||"",onChange:d,className:"input-field min-h-[80px] resize-none",placeholder:"Business address"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"City"}),e.jsx("input",{type:"text",name:"city",value:s.city||"",onChange:d,className:"input-field",placeholder:"City"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"State"}),e.jsx("input",{type:"text",name:"state",value:s.state||"",onChange:d,className:"input-field",placeholder:"State"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"PIN Code"}),e.jsx("input",{type:"text",name:"pincode",value:s.pincode||"",onChange:d,className:"input-field",placeholder:"PIN Code"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Phone Number"}),e.jsx("input",{type:"tel",name:"phone",value:s.phone||"",onChange:d,className:"input-field",placeholder:"Business phone"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Email Address"}),e.jsx("input",{type:"email",name:"email",value:s.email||"",onChange:d,className:"input-field",placeholder:"business@email.com"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Tax ID / Registration Number"}),e.jsx("input",{type:"text",name:"taxId",value:s.taxId||"",onChange:d,className:"input-field font-mono",placeholder:"Tax registration number"})]})]})]})}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"glass rounded-2xl p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Business Logo"}),s.logo?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:s.logo,alt:"Business logo",className:"w-full h-40 object-contain bg-white rounded-xl"}),e.jsx("button",{onClick:I,className:"absolute top-2 right-2 p-2 bg-coral-500 text-white rounded-lg hover:bg-coral-600 transition-colors",children:e.jsx(w,{className:"w-4 h-4"})})]}):e.jsxs("label",{className:"flex flex-col items-center justify-center w-full h-40 border-2 border-dashed border-midnight-600 rounded-xl cursor-pointer hover:border-teal-500/50 transition-colors",children:[e.jsx(S,{className:"w-8 h-8 text-midnight-500 mb-2"}),e.jsx("span",{className:"text-midnight-400 text-sm",children:"Upload logo"}),e.jsx("span",{className:"text-midnight-500 text-xs mt-1",children:"PNG, JPG up to 2MB"}),e.jsx("input",{type:"file",accept:"image/*",onChange:F,className:"hidden"})]})]}),e.jsxs("div",{className:"glass rounded-2xl p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Signature"}),e.jsx("p",{className:"text-midnight-400 text-sm mb-4",children:"Upload your signature to appear on invoices"}),s.signature?e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:s.signature,alt:"Signature",className:"w-full h-32 object-contain bg-white rounded-xl"}),e.jsx("button",{onClick:R,className:"absolute top-2 right-2 p-2 bg-coral-500 text-white rounded-lg hover:bg-coral-600 transition-colors",children:e.jsx(w,{className:"w-4 h-4"})})]}):e.jsxs("label",{className:"flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-midnight-600 rounded-xl cursor-pointer hover:border-teal-500/50 transition-colors",children:[e.jsx(S,{className:"w-8 h-8 text-midnight-500 mb-2"}),e.jsx("span",{className:"text-midnight-400 text-sm",children:"Upload signature"}),e.jsx("span",{className:"text-midnight-500 text-xs mt-1",children:"PNG, JPG up to 2MB"}),e.jsx("input",{type:"file",accept:"image/*",onChange:k,className:"hidden"})]})]})]})]}),b==="invoice"&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"glass rounded-2xl p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Invoice Defaults"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Invoice Prefix"}),e.jsx("input",{type:"text",name:"invoicePrefix",value:i.invoicePrefix||"",onChange:f,className:"input-field font-mono",placeholder:"INV"}),e.jsxs("p",{className:"text-midnight-500 text-xs mt-1",children:["Your invoices will be numbered like ",i.invoicePrefix,"-2026-0001"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Default Tax Rate (%)"}),e.jsx("input",{type:"number",name:"taxRate",min:"0",max:"100",value:i.taxRate||0,onChange:f,className:"input-field"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Tax Label"}),e.jsx("input",{type:"text",name:"taxLabel",value:i.taxLabel||"",onChange:f,className:"input-field",placeholder:"e.g., GST, VAT, Tax"})]})]})]}),e.jsxs("div",{className:"glass rounded-2xl p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Invoice Display"}),e.jsxs("label",{className:"flex items-center justify-between p-4 bg-midnight-800/50 rounded-xl cursor-pointer",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-white font-medium",children:"Show Business Logo"}),e.jsx("p",{className:"text-midnight-400 text-sm",children:"Display your logo on invoices"})]}),e.jsx("div",{className:`w-12 h-7 rounded-full transition-colors ${i.showLogo?"bg-teal-500":"bg-midnight-600"}`,onClick:A,children:e.jsx("div",{className:`w-5 h-5 bg-white rounded-full shadow transform transition-transform mt-1 ${i.showLogo?"translate-x-6":"translate-x-1"}`})})]})]}),e.jsxs("div",{className:"lg:col-span-2 glass rounded-2xl p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-white mb-4",children:"Invoice Preview"}),e.jsxs("div",{className:"bg-white rounded-xl p-6 text-gray-900",children:[e.jsxs("div",{className:"flex justify-between items-start border-b border-gray-200 pb-4",children:[e.jsxs("div",{children:[i.showLogo&&s.logo&&e.jsx("img",{src:s.logo,alt:"Logo",className:"h-12 mb-2"}),e.jsx("h3",{className:"font-bold text-lg",children:s.name||"Your Business Name"}),e.jsx("p",{className:"text-gray-500 text-sm",children:s.address||"Business Address"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-gray-400 text-sm uppercase",children:"Invoice"}),e.jsxs("p",{className:"font-mono font-bold",children:[i.invoicePrefix||"INV","-2026-0001"]})]})]}),e.jsx("div",{className:"mt-4 text-sm text-gray-600",children:e.jsxs("p",{children:[i.taxLabel||"Tax"," Rate: ",i.taxRate||0,"%"]})})]})]})]})]})}export{W as default};
