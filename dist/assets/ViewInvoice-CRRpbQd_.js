import{j as e}from"./react-query-0I5YXCIV.js";import{b as O,f as z,r as o,L as v}from"./react-vendor-GSsPULXx.js";import{c as W,g as Y,a as Q,d as V,f as r,n as H}from"./helpers-C0Vzrg-0.js";import{d as g,o as J,g as K}from"./pdfGenerator-D_X1X8mk.js";import{c as X,u as Z,b as _}from"./useData-D3VBIZIu.js";import{f as w,q as S,o as I,h as ee,C as se,A as te,s as ae,D as re,t as ne,u as le}from"./ui-libs-B_77BvNz.js";import"./database-DTV7DMIG.js";import"./index-C9ltvpI4.js";import"./supabase-DfwcnzK-.js";function be(){const P=O(),{id:A}=z(),{invoice:s,loading:C,saveInvoice:d}=X(A),{business:t,loading:T}=Z(),{settings:i,loading:D}=_(),F=o.useRef(null),[p,x]=o.useState(!1),[m,b]=o.useState(!1),[u,y]=o.useState(!1),j=C||T||D;if(j&&!s)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsxs("div",{className:"flex flex-col items-center gap-2",children:[e.jsx(w,{className:"animate-spin w-8 h-8 text-teal-400"}),e.jsx("p",{className:"text-midnight-400",children:"Loading invoice..."})]})});if(!s)return j?null:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-2xl font-bold text-white mb-4",children:"Invoice Not Found"}),e.jsxs(v,{to:"/invoices",className:"btn-primary inline-flex items-center gap-2",children:[e.jsx(S,{className:"w-5 h-5"}),"Back to Invoices"]})]});const l=W(s.items,s.taxRate,s.discount),k=()=>{g(s,t,i)},R=()=>{J(s,t,i)},L=async a=>{y(!0);try{const n={...s,status:a};await d(n),x(!1)}catch(n){console.error("Failed to update status",n)}finally{y(!1)}},$=async()=>{b(!0);try{const a=K(s,t,i),n=new File([a],`${s.invoiceNumber}.pdf`,{type:"application/pdf"});if(navigator.share&&navigator.canShare({files:[n]})){if(await navigator.share({title:`Invoice ${s.invoiceNumber}`,text:`Invoice for ${s.customerName} - ${r(l.total,t.currency)}`,files:[n]}),s.status!=="paid"){const c={...s,status:"paid"};await d(c)}}else if(g(s,t,i),s.status!=="paid"){const c={...s,status:"paid"};await d(c)}}catch(a){if(a.name!=="AbortError"&&(console.error("Error sharing:",a),g(s,t,i),s.status!=="paid"))try{const c={...s,status:"paid"};await d(c)}catch(c){console.error("Failed to update invoice status:",c)}}b(!1)},B=[{value:"draft",label:"Draft",icon:I,color:"text-midnight-400"},{value:"pending",label:"Pending",icon:ee,color:"text-gold-400"},{value:"paid",label:"Paid",icon:se,color:"text-teal-400"},{value:"overdue",label:"Overdue",icon:te,color:"text-coral-400"}],E=s.taxRate/2,U=s.taxRate/2,G=l.taxAmount/2,q=l.taxAmount/2;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:()=>P("/invoices"),className:"p-2 rounded-lg hover:bg-midnight-700 transition-colors",children:e.jsx(S,{className:"w-5 h-5 text-midnight-300"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-2xl font-display font-bold text-white",children:s.invoiceNumber}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>x(!p),className:`px-3 py-1 rounded-full text-sm font-medium ${Q(s.status)} hover:opacity-80 transition-opacity flex items-center gap-2`,disabled:u,children:u?e.jsx(w,{className:"w-3 h-3 animate-spin"}):Y(s.status)}),p&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"fixed inset-0 z-10",onClick:()=>x(!1)}),e.jsx("div",{className:"absolute left-0 top-full mt-2 w-40 bg-midnight-800 border border-midnight-600 rounded-xl shadow-lg overflow-hidden z-20",children:B.map(a=>{const n=a.icon;return e.jsxs("button",{onClick:()=>L(a.value),className:`flex items-center gap-3 px-4 py-3 w-full hover:bg-midnight-700 transition-colors ${s.status===a.value?"bg-midnight-700":""}`,children:[e.jsx(n,{className:`w-4 h-4 ${a.color}`}),e.jsx("span",{className:"text-white",children:a.label}),s.status===a.value&&e.jsx(ae,{className:"w-4 h-4 text-teal-400 ml-auto"})]},a.value)})})]})]})]}),e.jsx("p",{className:"text-midnight-400",children:s.customerName})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 w-full sm:w-auto",children:[e.jsxs(v,{to:`/invoices/edit/${s.id}`,className:"btn-secondary flex items-center justify-center gap-2 flex-1 sm:flex-none",children:[e.jsx(I,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden xs:inline",children:"Edit"})]}),e.jsxs("button",{onClick:k,className:"btn-secondary flex items-center justify-center gap-2 flex-1 sm:flex-none",children:[e.jsx(re,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden xs:inline",children:"Download"})]}),e.jsxs("button",{onClick:R,className:"btn-secondary flex items-center justify-center gap-2 flex-1 sm:flex-none",children:[e.jsx(ne,{className:"w-4 h-4"}),e.jsx("span",{className:"hidden xs:inline",children:"Print"})]}),e.jsxs("button",{onClick:$,disabled:m,className:"btn-primary flex items-center justify-center gap-2 flex-1 sm:flex-none disabled:opacity-50",children:[e.jsx(le,{className:`w-4 h-4 ${m?"animate-pulse":""}`}),m?"Sharing...":"Share PDF"]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-soft overflow-hidden",ref:F,children:[e.jsx("div",{className:"text-center py-4 border-b border-gray-300",children:e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Tax Invoice"})}),e.jsx("div",{className:"px-8 py-6 border-b-2 border-gray-900",children:e.jsxs("div",{className:"flex justify-between items-start gap-6",children:[e.jsx("div",{className:"flex-shrink-0",children:i.showLogo&&t.logo?e.jsx("img",{src:t.logo,alt:t.name||"Business Logo",className:"w-20 h-20 object-contain"}):e.jsx("div",{className:"w-20 h-20"})}),e.jsxs("div",{className:"text-right flex-1",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:t.name||"Your Business Name"}),t.address&&e.jsx("p",{className:"text-gray-700 text-sm mt-1",children:t.address}),t.city&&e.jsxs("p",{className:"text-gray-700 text-sm",children:[t.city,t.state&&`, ${t.state}`," ",t.pincode]}),t.phone&&e.jsxs("p",{className:"text-gray-700 text-sm",children:["Phone no.: ",t.phone]}),t.email&&e.jsxs("p",{className:"text-gray-700 text-sm",children:["Email: ",t.email]}),t.taxId&&e.jsxs("p",{className:"text-gray-700 text-sm",children:["GSTIN: ",t.taxId,", State: ",t.state||"09-Uttar Pradesh"]})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 border-b-2 border-gray-900",children:[e.jsxs("div",{className:"px-6 py-4 border-r-2 border-gray-900",children:[e.jsx("p",{className:"text-gray-900 font-bold mb-2",children:"Bill To"}),e.jsx("p",{className:"text-gray-900 font-semibold text-base",children:s.customerName}),s.customerAddress&&e.jsx("p",{className:"text-gray-700 text-sm mt-1",children:s.customerAddress}),e.jsxs("p",{className:"text-gray-700 text-sm mt-1",children:["State: ",t.state||"09-Uttar Pradesh"]})]}),e.jsxs("div",{className:"px-6 py-4",children:[e.jsx("p",{className:"text-gray-900 font-bold mb-2",children:"Invoice Details"}),e.jsxs("p",{className:"text-gray-700 text-sm",children:["Invoice No.: ",s.invoiceNumber]}),e.jsxs("p",{className:"text-gray-700 text-sm mt-1",children:["Date: ",V(s.date)]}),e.jsxs("p",{className:"text-gray-700 text-sm mt-1",children:["Place of Supply: ",t.state||"09-Uttar Pradesh"]})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b-2 border-gray-900",children:[e.jsx("th",{className:"text-center py-3 px-2 text-gray-900 font-bold border-r border-gray-300 w-12",children:"#"}),e.jsx("th",{className:"text-left py-3 px-3 text-gray-900 font-bold border-r border-gray-300",children:"Item name"}),e.jsx("th",{className:"text-center py-3 px-2 text-gray-900 font-bold border-r border-gray-300 w-20",children:"Quantity"}),e.jsx("th",{className:"text-center py-3 px-2 text-gray-900 font-bold border-r border-gray-300 w-16",children:"Unit"}),e.jsx("th",{className:"text-right py-3 px-3 text-gray-900 font-bold border-r border-gray-300 w-24",children:"Price/Unit"}),e.jsx("th",{className:"text-right py-3 px-3 text-gray-900 font-bold border-r border-gray-300 w-24",children:"Discount"}),e.jsxs("th",{className:"text-right py-3 px-3 text-gray-900 font-bold border-r border-gray-300 w-28",children:["Taxable",e.jsx("br",{}),"amount"]}),e.jsx("th",{className:"text-right py-3 px-3 text-gray-900 font-bold border-r border-gray-300 w-24",children:"GST"}),e.jsx("th",{className:"text-right py-3 px-3 text-gray-900 font-bold w-28",children:"Amount"})]})}),e.jsx("tbody",{children:s.items.map((a,n)=>{const c=a.quantity*a.price,N=c*s.discount/100,h=c-N,f=h*s.taxRate/100,M=h+f;return e.jsxs("tr",{className:"border-b border-gray-300",children:[e.jsx("td",{className:"py-3 px-2 text-gray-900 text-center border-r border-gray-300",children:n+1}),e.jsx("td",{className:"py-3 px-3 text-gray-900 font-medium border-r border-gray-300",children:a.name}),e.jsx("td",{className:"py-3 px-2 text-gray-900 text-center border-r border-gray-300",children:a.quantity}),e.jsx("td",{className:"py-3 px-2 text-gray-900 text-center border-r border-gray-300",children:a.unit||"PCS"}),e.jsx("td",{className:"py-3 px-3 text-gray-900 text-right border-r border-gray-300",children:r(a.price,t.currency)}),e.jsxs("td",{className:"py-3 px-3 text-gray-900 text-right border-r border-gray-300",children:[r(N,t.currency),e.jsx("br",{}),e.jsxs("span",{className:"text-xs text-gray-600",children:["(",s.discount,"%)"]})]}),e.jsx("td",{className:"py-3 px-3 text-gray-900 text-right border-r border-gray-300",children:r(h,t.currency)}),e.jsxs("td",{className:"py-3 px-3 text-gray-900 text-right border-r border-gray-300",children:[r(f,t.currency),e.jsx("br",{}),e.jsxs("span",{className:"text-xs text-gray-600",children:["(",s.taxRate.toFixed(1),"%)"]})]}),e.jsx("td",{className:"py-3 px-3 text-gray-900 text-right font-medium",children:r(M,t.currency)})]},a.id)})})]})}),e.jsxs("div",{className:"grid grid-cols-2 border-t-2 border-gray-900",children:[e.jsxs("div",{className:"px-6 py-4 border-r-2 border-gray-900",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-3 border-b border-gray-300 pb-2 mb-2 text-xs font-bold text-gray-900",children:[e.jsx("div",{className:"col-span-2 text-left",children:"Tax type"}),e.jsx("div",{className:"col-span-4 text-right",children:"Taxable amount"}),e.jsx("div",{className:"col-span-2 text-center",children:"Rate"}),e.jsx("div",{className:"col-span-4 text-right",children:"Tax amount"})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-3 border-b border-gray-300 py-2 text-xs text-gray-900",children:[e.jsx("div",{className:"col-span-2 text-left",children:"SGST"}),e.jsx("div",{className:"col-span-4 text-right",children:r(l.taxableAmount,t.currency)}),e.jsxs("div",{className:"col-span-2 text-center",children:[E.toFixed(1),"%"]}),e.jsx("div",{className:"col-span-4 text-right",children:r(G,t.currency)})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-3 py-2 text-xs text-gray-900",children:[e.jsx("div",{className:"col-span-2 text-left",children:"CGST"}),e.jsx("div",{className:"col-span-4 text-right",children:r(l.taxableAmount,t.currency)}),e.jsxs("div",{className:"col-span-2 text-center",children:[U.toFixed(1),"%"]}),e.jsx("div",{className:"col-span-4 text-right",children:r(q,t.currency)})]})]}),e.jsxs("div",{className:"px-6 py-4",children:[e.jsx("p",{className:"text-gray-900 font-bold mb-3",children:"Amounts"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-700",children:"Sub Total"}),e.jsx("span",{className:"text-gray-900 font-medium",children:r(l.taxableAmount,t.currency)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-700",children:"Round off"}),e.jsxs("span",{className:"text-gray-900 font-medium",children:[l.roundOff>=0?"":"- ",r(Math.abs(l.roundOff),t.currency)]})]}),e.jsxs("div",{className:"flex justify-between pt-2 border-t border-gray-300",children:[e.jsx("span",{className:"text-gray-900 font-bold text-base",children:"Total"}),e.jsx("span",{className:"text-gray-900 font-bold text-base",children:r(l.total,t.currency)})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 border-t-2 border-gray-900",children:[e.jsxs("div",{className:"px-6 py-4 border-r-2 border-gray-900",children:[e.jsxs("div",{className:"mb-4 pb-4 border-b border-gray-300",children:[e.jsx("p",{className:"text-gray-900 font-bold mb-1",children:"Invoice Amount In Words"}),e.jsxs("p",{className:"text-gray-700 text-sm",children:[H(Math.floor(l.total))," Rupees only"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-900 font-bold mb-2",children:"Terms and conditions"}),s.notes&&e.jsx("div",{className:"mt-3 text-sm text-gray-700",children:e.jsx("p",{className:"whitespace-pre-line",children:s.notes})})]})]}),e.jsxs("div",{className:"px-6 py-4 flex flex-col justify-between",children:[e.jsxs("p",{className:"text-gray-900 text-sm",children:["For: ",t.name||"Your Business Name"]}),e.jsxs("div",{className:"text-center mt-auto pt-8",children:[t.signature&&e.jsx("div",{className:"mb-2",children:e.jsx("img",{src:t.signature,alt:"Signature",className:"h-16 mx-auto object-contain"})}),e.jsx("div",{className:"inline-block border-t-2 border-gray-400 pt-2 min-w-[150px]",children:e.jsx("p",{className:"text-gray-900 font-bold text-sm",children:"Authorized Signatory"})})]})]})]})]})]})}export{be as default};
