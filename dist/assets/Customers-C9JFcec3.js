import{j as e}from"./react-query-BSlkKaxv.js";import{r as n,L as z}from"./react-vendor-DCAT8MD5.js";import{e as T}from"./helpers-nstW7FaL.js";import{d as q,a as Q}from"./useData-DA7kAvo6.js";import{h as S,P as k,l as R,U as O,F as X,x as B,y as G,z as H,q as J,r as K,X as V,t as W}from"./ui-libs-BRCIjeTj.js";import"./database-DI5YpnAh.js";import"./index-CEIjRt6s.js";import"./supabase-DfwcnzK-.js";function ne(){const{customers:x,loading:D,saveCustomer:F,deleteCustomer:L}=q(),{invoices:A}=Q(),[l,E]=n.useState(""),[I,g]=n.useState(!1),[i,h]=n.useState(null),[v,u]=n.useState(null),[b,w]=n.useState(!1),[p,y]=n.useState(!1),[t,r]=n.useState({name:"",phone:"",email:"",address:""}),[c,d]=n.useState({}),M=s=>A.filter(a=>a.customerName===s).length,C=x.filter(s=>{var a,o;return s.name.toLowerCase().includes(l.toLowerCase())||((a=s.phone)==null?void 0:a.includes(l))||((o=s.email)==null?void 0:o.toLowerCase().includes(l.toLowerCase()))}),j=(s=null)=>{s?(h(s),r({name:s.name,phone:s.phone||"",email:s.email||"",address:s.address||""})):(h(null),r({name:"",phone:"",email:"",address:""})),d({}),g(!0)},f=()=>{g(!1),h(null),r({name:"",phone:"",email:"",address:""}),d({})},m=s=>{const{name:a,value:o}=s.target;r(N=>({...N,[a]:o})),c[a]&&d(N=>({...N,[a]:null}))},P=()=>{const s={};return t.name.trim()||(s.name="Customer name is required"),d(s),Object.keys(s).length===0},U=async()=>{if(P()){w(!0);try{const s={id:(i==null?void 0:i.id)||T(),name:t.name.trim(),phone:t.phone.trim(),email:t.email.trim(),address:t.address.trim()};await F(s),f()}catch(s){console.error("Failed to save customer:",s)}finally{w(!1)}}},$=async s=>{y(!0);try{await L(s)}catch(a){console.error("Failed to delete customer:",a)}finally{y(!1),u(null)}};return D&&x.length===0?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center",children:[e.jsx(S,{className:"w-8 h-8 text-teal-400 animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-midnight-400",children:"Loading customers..."})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-display font-bold text-white",children:"Customers"}),e.jsxs("p",{className:"text-midnight-400",children:[x.length," customers"]})]}),e.jsxs("button",{onClick:()=>j(),className:"btn-primary flex items-center gap-2 self-start",children:[e.jsx(k,{className:"w-5 h-5"}),e.jsx("span",{children:"Add Customer"})]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(R,{className:`absolute left-3.5 top-1/2 -translate-y-1/2 w-5 h-5 text-midnight-400 pointer-events-none transition-opacity duration-200 ${l?"opacity-0":"opacity-100"}`}),e.jsx("input",{type:"text",placeholder:"",value:l,onChange:s=>E(s.target.value),className:"input-field pl-11"})]}),C.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(O,{className:"w-16 h-16 text-midnight-600 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:l?"No customers found":"No customers yet"}),e.jsx("p",{className:"text-midnight-400 mb-6",children:l?"Try adjusting your search":"Customers are automatically added when you create invoices"}),!l&&e.jsxs("button",{onClick:()=>j(),className:"btn-primary inline-flex items-center gap-2",children:[e.jsx(k,{className:"w-5 h-5"}),"Add Customer"]})]}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:C.map(s=>{const a=M(s.name);return e.jsx("div",{className:"glass rounded-xl p-5 card-hover animate-fade-in",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-teal-500/20 flex items-center justify-center",children:e.jsx("span",{className:"text-teal-400 font-semibold",children:s.name.charAt(0).toUpperCase()})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-white truncate",children:s.name}),a>0&&e.jsxs(z,{to:`/invoices?search=${encodeURIComponent(s.name)}`,className:"text-teal-400 text-sm hover:text-teal-300 flex items-center gap-1",children:[e.jsx(X,{className:"w-3 h-3"}),a," invoice",a>1?"s":""]})]})]}),e.jsxs("div",{className:"mt-4 space-y-2",children:[s.phone&&e.jsxs("div",{className:"flex items-center gap-2 text-midnight-400 text-sm",children:[e.jsx(B,{className:"w-4 h-4"}),e.jsx("a",{href:`tel:${s.phone}`,className:"hover:text-white",children:s.phone})]}),s.email&&e.jsxs("div",{className:"flex items-center gap-2 text-midnight-400 text-sm",children:[e.jsx(G,{className:"w-4 h-4"}),e.jsx("a",{href:`mailto:${s.email}`,className:"hover:text-white truncate",children:s.email})]}),s.address&&e.jsxs("div",{className:"flex items-start gap-2 text-midnight-400 text-sm",children:[e.jsx(H,{className:"w-4 h-4 flex-shrink-0 mt-0.5"}),e.jsx("span",{className:"line-clamp-2",children:s.address})]})]})]}),e.jsxs("div",{className:"flex gap-1 ml-2",children:[e.jsx("button",{onClick:()=>j(s),className:"p-2 text-midnight-400 hover:text-white hover:bg-midnight-700 rounded-lg transition-colors",children:e.jsx(J,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>u(s.id),className:"p-2 text-midnight-400 hover:text-coral-400 hover:bg-coral-500/10 rounded-lg transition-colors",children:e.jsx(K,{className:"w-4 h-4"})})]})]})},s.id)})}),I&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70",children:e.jsxs("div",{className:"glass rounded-2xl p-6 max-w-md w-full animate-scale-in",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-xl font-semibold text-white",children:i?"Edit Customer":"Add Customer"}),e.jsx("button",{onClick:f,className:"p-2 hover:bg-midnight-700 rounded-lg transition-colors",children:e.jsx(V,{className:"w-5 h-5 text-midnight-400"})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Customer Name *"}),e.jsx("input",{type:"text",name:"name",value:t.name,onChange:m,className:`input-field ${c.name?"border-coral-500":""}`,placeholder:"Full name"}),c.name&&e.jsx("p",{className:"text-coral-400 text-sm mt-1",children:c.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Phone Number"}),e.jsx("input",{type:"tel",name:"phone",value:t.phone,onChange:m,className:"input-field",placeholder:"Mobile number"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Email Address"}),e.jsx("input",{type:"email",name:"email",value:t.email,onChange:m,className:"input-field",placeholder:"email@example.com"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"input-label",children:"Address"}),e.jsx("textarea",{name:"address",value:t.address,onChange:m,className:"input-field min-h-[80px] resize-none",placeholder:"Full address"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:f,className:"btn-secondary flex-1",children:"Cancel"}),e.jsxs("button",{onClick:U,disabled:b,className:"btn-primary flex-1 flex items-center justify-center gap-2",children:[b?e.jsx(S,{className:"w-4 h-4 animate-spin"}):e.jsx(W,{className:"w-4 h-4"}),i?"Update":"Add Customer"]})]})]})}),v&&e.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/70",children:e.jsxs("div",{className:"glass rounded-2xl p-6 max-w-md w-full animate-scale-in",children:[e.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"Delete Customer?"}),e.jsx("p",{className:"text-midnight-400 mb-6",children:"This customer will be permanently deleted."}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:()=>u(null),className:"btn-secondary",disabled:p,children:"Cancel"}),e.jsx("button",{onClick:()=>$(v),className:"btn-danger",disabled:p,children:p?"Deleting...":"Delete"})]})]})})]})}export{ne as default};
