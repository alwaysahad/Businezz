import{u as Q,b as p,c as m}from"./react-query-0I5YXCIV.js";import{b as I,i as f,s as C,c as K,p as D}from"./database-Dl3kmWnY.js";import{u as q}from"./index-CHnLeUAe.js";const e={invoices:["invoices"],invoice:i=>["invoices",i],customers:["customers"],products:["products"],business:["business"],settings:["settings"]};function b(){const{lastSyncTime:i}=q(),s=Q(),{data:c=[],isLoading:y,error:d}=p({queryKey:e.invoices,queryFn:()=>f.getAll(),staleTime:5*60*1e3});i&&s.invalidateQueries({queryKey:e.invoices});const v=m({mutationFn:r=>f.save(r),onMutate:async r=>{await s.cancelQueries({queryKey:e.invoices});const a=s.getQueryData(e.invoices);return s.setQueryData(e.invoices,(t=[])=>{const o=t.findIndex(u=>u.id===r.id);if(o>=0){const u=[...t];return u[o]=r,u}return[r,...t]}),{previousInvoices:a}},onError:(r,a,t)=>{t!=null&&t.previousInvoices&&s.setQueryData(e.invoices,t.previousInvoices)},onSettled:()=>{s.invalidateQueries({queryKey:e.invoices})}}),l=m({mutationFn:r=>f.delete(r),onMutate:async r=>{await s.cancelQueries({queryKey:e.invoices});const a=s.getQueryData(e.invoices);return s.setQueryData(e.invoices,(t=[])=>t.filter(o=>o.id!==r)),{previousInvoices:a}},onError:(r,a,t)=>{t!=null&&t.previousInvoices&&s.setQueryData(e.invoices,t.previousInvoices)},onSettled:()=>{s.invalidateQueries({queryKey:e.invoices})}});return{invoices:c,loading:y,error:d,refresh:()=>s.invalidateQueries({queryKey:e.invoices}),saveInvoice:v.mutateAsync,deleteInvoice:l.mutateAsync}}function A(i){const{lastSyncTime:s}=q(),c=Q(),{data:y=null,isLoading:d,error:v}=p({queryKey:e.invoice(i||""),queryFn:()=>i?f.getById(i):Promise.resolve(null),enabled:!!i,staleTime:5*60*1e3});s&&i&&c.invalidateQueries({queryKey:e.invoice(i)});const l=m({mutationFn:n=>f.save(n),onSuccess:n=>{c.setQueryData(e.invoice(n.id),n),c.invalidateQueries({queryKey:e.invoices})}});return{invoice:y,loading:d,error:v,saveInvoice:l.mutateAsync}}function T(){const{lastSyncTime:i}=q(),s=Q(),{data:c=[],isLoading:y,error:d}=p({queryKey:e.customers,queryFn:()=>K.getAll(),staleTime:5*60*1e3});i&&s.invalidateQueries({queryKey:e.customers});const v=m({mutationFn:r=>K.save(r),onMutate:async r=>{await s.cancelQueries({queryKey:e.customers});const a=s.getQueryData(e.customers);return s.setQueryData(e.customers,(t=[])=>{const o=t.findIndex(u=>u.id===r.id);if(o>=0){const u=[...t];return u[o]=r,u}return[...t,r].sort((u,g)=>u.name.localeCompare(g.name))}),{previousCustomers:a}},onError:(r,a,t)=>{t!=null&&t.previousCustomers&&s.setQueryData(e.customers,t.previousCustomers)},onSettled:()=>{s.invalidateQueries({queryKey:e.customers})}}),l=m({mutationFn:r=>K.delete(r),onMutate:async r=>{await s.cancelQueries({queryKey:e.customers});const a=s.getQueryData(e.customers);return s.setQueryData(e.customers,(t=[])=>t.filter(o=>o.id!==r)),{previousCustomers:a}},onError:(r,a,t)=>{t!=null&&t.previousCustomers&&s.setQueryData(e.customers,t.previousCustomers)},onSettled:()=>{s.invalidateQueries({queryKey:e.customers})}});return{customers:c,loading:y,error:d,refresh:()=>s.invalidateQueries({queryKey:e.customers}),saveCustomer:v.mutateAsync,deleteCustomer:l.mutateAsync}}function _(){const{lastSyncTime:i}=q(),s=Q(),{data:c=[],isLoading:y,error:d}=p({queryKey:e.products,queryFn:()=>D.getAll(),staleTime:5*60*1e3});i&&s.invalidateQueries({queryKey:e.products});const v=m({mutationFn:r=>D.save(r),onMutate:async r=>{await s.cancelQueries({queryKey:e.products});const a=s.getQueryData(e.products);return s.setQueryData(e.products,(t=[])=>{const o=t.findIndex(u=>u.id===r.id);if(o>=0){const u=[...t];return u[o]=r,u}return[...t,r].sort((u,g)=>u.name.localeCompare(g.name))}),{previousProducts:a}},onError:(r,a,t)=>{t!=null&&t.previousProducts&&s.setQueryData(e.products,t.previousProducts)},onSettled:()=>{s.invalidateQueries({queryKey:e.products})}}),l=m({mutationFn:r=>D.delete(r),onMutate:async r=>{await s.cancelQueries({queryKey:e.products});const a=s.getQueryData(e.products);return s.setQueryData(e.products,(t=[])=>t.filter(o=>o.id!==r)),{previousProducts:a}},onError:(r,a,t)=>{t!=null&&t.previousProducts&&s.setQueryData(e.products,t.previousProducts)},onSettled:()=>{s.invalidateQueries({queryKey:e.products})}});return{products:c,loading:y,error:d,refresh:()=>s.invalidateQueries({queryKey:e.products}),saveProduct:v.mutateAsync,deleteProduct:l.mutateAsync}}function P(){const{lastSyncTime:i}=q(),s=Q(),{data:c={},isLoading:y,error:d}=p({queryKey:e.business,queryFn:async()=>await I.get()||{},staleTime:5*60*1e3});i&&s.invalidateQueries({queryKey:e.business});const v=m({mutationFn:n=>I.save(n),onSuccess:n=>{s.setQueryData(e.business,n)}});return{business:c,loading:y,error:d,refresh:()=>s.invalidateQueries({queryKey:e.business}),saveBusiness:v.mutateAsync}}function h(){const{lastSyncTime:i}=q(),s=Q(),{data:c={},isLoading:y,error:d}=p({queryKey:e.settings,queryFn:async()=>await C.get()||{},staleTime:5*60*1e3});i&&s.invalidateQueries({queryKey:e.settings});const v=m({mutationFn:n=>C.save(n),onSuccess:n=>{s.setQueryData(e.settings,n)}});return{settings:c,loading:y,error:d,refresh:()=>s.invalidateQueries({queryKey:e.settings}),saveSettings:v.mutateAsync}}export{b as a,h as b,A as c,T as d,_ as e,P as u};
