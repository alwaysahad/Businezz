import{r as o}from"./react-vendor-DCAT8MD5.js";const h=()=>{const[l,a]=o.useState({isGenerating:!1,progress:0,message:"",error:null}),e=o.useRef(null),m=o.useRef(null);o.useEffect(()=>(e.current=new Worker(new URL("/assets/pdfWorker-GjVV6PXg.js",import.meta.url),{type:"module"}),()=>{var n;(n=e.current)==null||n.terminate()}),[]);const L=o.useCallback(()=>{var n;(n=m.current)==null||n.abort(),a(c=>({...c,isGenerating:!1,error:"PDF generation cancelled"}))},[]),d=o.useCallback((n,c,p)=>new Promise((b,s)=>{if(!e.current){s(new Error("PDF Worker not initialized"));return}m.current=new AbortController,a({isGenerating:!0,progress:0,message:"Starting PDF generation...",error:null});const t=i=>{var v,E,w,k;const{type:u,progress:g,message:P,blob:D,error:f}=i.data;switch(u){case"progress":a(F=>({...F,progress:g,message:P}));break;case"success":a({isGenerating:!1,progress:100,message:"PDF generated successfully!",error:null}),(v=e.current)==null||v.removeEventListener("message",t),(E=e.current)==null||E.removeEventListener("error",r),b(D);break;case"error":a({isGenerating:!1,progress:0,message:"",error:f}),(w=e.current)==null||w.removeEventListener("message",t),(k=e.current)==null||k.removeEventListener("error",r),s(new Error(f));break}},r=i=>{var u,g;a({isGenerating:!1,progress:0,message:"",error:i.message||"Unknown error occurred"}),(u=e.current)==null||u.removeEventListener("message",t),(g=e.current)==null||g.removeEventListener("error",r),s(i)};if(m.current.signal.aborted){s(new Error("PDF generation cancelled"));return}e.current.addEventListener("message",t),e.current.addEventListener("error",r),e.current.postMessage({type:"generate",invoice:n,business:c,settings:p})}),[]),G=o.useCallback(async(n,c,p,b)=>{try{const s=await d(n,c,p),t=URL.createObjectURL(s),r=document.createElement("a");r.href=t,r.download=b,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(t)}catch(s){throw console.error("Error downloading PDF:",s),s}},[d]);return{generatePDF:d,downloadPDF:G,isGenerating:l.isGenerating,progress:l.progress,message:l.message,error:l.error,cancelGeneration:L}};export{h as u};
